<div class="surface-ground border-top-1 border-bottom-1 border-gray-300 px-4 py-3">
  <div class="flex flex-column md:align-items-center md:justify-content-between md:flex-row">
    <div class="font-medium text-3xl text-900">BB{{vulnerability.programid}} - {{vulnerability.bprogramme_name}} (Edit
      Vulnerability)</div>
      <div class="mt-3 md:mt-0">
        <button *ngIf="vulnerability.isEditable" pButton pRipple type="button" label="Update" icon="pi pi-save" class="p-button-success"
            (click)="saveVuln()"></button>
          <button pTooltip="Back" [routerLink]="['/ViewVulnerability/'+ srno]"
              tooltipPosition="top" label="Back" pButton pRipple style="margin-left: 4px;" type="button"
              icon="pi pi-arrow-circle-left" class="p-button-primary"></button>
      </div>
  </div>
</div>
<br>
<div *ngIf="NotAccessible == false">
  <div class="flex flex-wrap">
    <div class="w-full lg:w-12 px-5">
      <ul class="surface-card p-3 m-0 list-none flex overflow-x-auto select-none">
        <li class="pr-3">
          <a pRipple
            class="cursor-pointer px-4 py-3 flex align-items-center hover:surface-100 border-round transition-colors transition-duration-150"
            [ngClass]="{'bg-primary hover:bg-primary': active4 === 0, 'text-700': active4 !== 0}" (click)="active4 = 0">
            <i class="pi pi-home mr-2"></i>
            <span class="font-medium">Overview</span>
          </a>
        </li>
        <li class="flex align-items-center">
          <div style="width:1px; height: 50%" class="border-right-1 surface-border"></div>
        </li>
        <li class="px-3">
          <a pRipple
            class="cursor-pointer px-4 py-3 flex align-items-center hover:surface-100 border-round transition-colors transition-duration-150"
            [ngClass]="{'bg-primary hover:bg-primary': active4 === 1, 'text-700': active4 !== 2}" (click)="active4 = 1">
            <i class="pi pi-list mr-2"></i>
            <span class="font-medium">Impact</span>
          </a>
        </li>
        <li class="flex align-items-center">
          <div style="width:1px; height: 50%" class="border-right-1 surface-border"></div>
        </li>
        <li class="px-3">
          <a pRipple
            class="cursor-pointer px-4 py-3 flex align-items-center hover:surface-100 border-round transition-colors transition-duration-150"
            [ngClass]="{'bg-primary hover:bg-primary': active4 === 2, 'text-700': active4 !== 2}" (click)="active4 = 2">
            <i class="pi pi-check mr-2"></i>
            <span class="font-medium">Steps to Reproduce</span>
          </a>
        </li>
        <li class="flex align-items-center">
          <div style="width:1px; height: 50%" class="border-right-1 surface-border"></div>
        </li>
        <li class="px-3">
          <a pRipple
            class="cursor-pointer px-4 py-3 flex align-items-center hover:surface-100 border-round transition-colors transition-duration-150"
            [ngClass]="{'bg-primary hover:bg-primary': active4 === 3, 'text-700': active4 !== 3}" (click)="active4 = 3">
            <i class="pi pi-cog mr-2"></i>
            <span class="font-medium">Remediation</span>
          </a>
        </li>
        <li class="flex align-items-center">
          <div style="width:1px; height: 50%" class="border-right-1 surface-border"></div>
        </li>
        <li class="px-3">
          <a pRipple
            class="cursor-pointer px-4 py-3 flex align-items-center hover:surface-100 border-round transition-colors transition-duration-150"
            [ngClass]="{'bg-primary hover:bg-primary': active4 === 4, 'text-700': active4 !== 4}" (click)="active4 = 4">
            <i class="pi pi-book mr-2"></i>
            <span class="font-medium">Remarks</span>
          </a>
        </li>
        <li class="flex align-items-center">
          <div style="width:1px; height: 50%" class="border-right-1 surface-border"></div>
        </li>
        <li class="px-3">
          <a pRipple
            class="cursor-pointer px-4 py-3 flex align-items-center hover:surface-100 border-round transition-colors transition-duration-150"
            [ngClass]="{'bg-primary hover:bg-primary': active4 === 5, 'text-700': active4 !== 5}" (click)="active4 = 5">
            <i class="pi pi-bell mr-2"></i>
            <span class="font-medium">History</span>
          </a>
        </li>
        <li class="flex align-items-center">
          <div style="width:1px; height: 50%" class="border-right-1 surface-border"></div>
        </li>

      </ul>
    </div>
  </div>

  <br>

  <div class="flex flex-wrap">
    <div class="w-full lg:w-12 px-5">
      <div class="surface-card" *ngIf="active4 == 0" style="padding: 4%;">
        <div class="grid">
          <div class="grid col-12 md:col-12">
            <label class="col-12 md:col-12">Title<span style="color: red">*</span>: </label>
            <div class="col-12 md:col-12">
              <input pInputText type="text" [(ngModel)]="vulnerability.title" placeholder="Enter Title" maxlength="500"
                style="width: 100% !important;">
            </div>
          </div>
        </div>

        <div class="grid">
          <div class="grid col-12 md:col-12">
            <label class="col-12 md:col-12">Description<span style="color: red">*</span>: </label>
            <div class="col-12 md:col-12">
              <textarea class="col-12 md:col-12" pInputTextarea rows=5 [(ngModel)]="vulnerability.description"
                style="width: 100% !important;" maxlength="50000" placeholder="Provide Description"></textarea>
            </div>
          </div>
        </div>

        <div class="grid">
          <div class="grid col-12 md:col-3">
            <label class="col-12 md:col-12">CVSS Score<span style="color: red"> *</span>:</label>
            <div class="col-12 md:col-12">
              <p-inputNumber [(ngModel)]="vulnerability.cvssScore" inputId="minmaxfraction" mode="decimal"
                [minFractionDigits]="0" [maxFractionDigits]="2" :[min]="0" :[max]="10"></p-inputNumber>
            </div>
          </div>

          <div class="grid col-12 md:col-9">
            <label class="col-12 md:col-12">CVSS v3.1 Vector<span style="color: red"> *</span>:</label>
            <div class="col-12 md:col-12">
              <input pInputText type="text" [(ngModel)]="vulnerability.cvss3vector" placeholder="Enter CVSS v3.1 Vector"
                maxlength="500" style="width: 100% !important;">
            </div>
          </div>
        </div>
        
        <div class="grid">
          <div class="grid col-12 md:col-12">
            <label class="col-12 md:col-12">Vulnerability Category<span style="color: red">*</span>: </label>
            <div class="col-12 md:col-12">
              <p-dropdown [options]="VulnCategory" placeholder="Select Assessment Type"
                [(ngModel)]="vulnerability.assessmenttype" optionLabel="result" [style]="{'width':'100%'}"
                optionValue="srno"></p-dropdown>
            </div>
          </div>
        </div>

      </div>

      <div class="surface-card" *ngIf="active4 == 1" style="padding: 4%;">
        <div class="grid">
          <div class="grid col-12 md:col-6">
            <label class="col-12 md:col-12">Impacted Security Property<span style="color: red">*</span>:
            </label>
            <div class="col-12 md:col-12">
              <p-multiSelect display="chip" [options]="cia" [(ngModel)]="selectedCIA"
                defaultLabel="Select Impacted Security Property" optionLabel="lookupvalue" optionValue="lookupcode"
                selectedItemsLabel="{0} items selected" autoWidth="false" [style]="{'width':'100%'}">
              </p-multiSelect>
            </div>
          </div>
          <div class="grid col-12 md:col-6">
            <label class="col-12 md:col-12">ASVS Categories<span style="color: red">*</span>: </label>
            <div class="col-12 md:col-12">
              <p-multiSelect display="chip" [options]="ASVSList" [(ngModel)]="asvs"
                defaultLabel="Select Asvs Categories" optionLabel="lookupvalue" optionValue="lookupcode" selectedItemsLabel="{0} items selected"
                autoWidth="false" [style]="{'width':'100%'}">
              </p-multiSelect>
            </div>
          </div>
        </div>

        <div class="grid">
          <div class="grid col-12 md:col-12">
            <label class="col-12 md:col-12">Impact<span style="color: red">*</span>: </label>
            <div class="col-12 md:col-12">
              <textarea class="col-12 md:col-12" pInputTextarea rows=5 [(ngModel)]="vulnerability.impact"
                style="width: 100% !important;" maxlength="50000" placeholder="Impact on End users"></textarea>
            </div>
          </div>
        </div>
        <div class="grid">
          <div class="grid col-12 md:col-12">
            <label class="col-12 md:col-12">Attack URL(s)<span style="color: red">*</span>: </label>
            <div class="col-12 md:col-12 grid">
              <div class="col-12 md:col-11">
                <input name="port" [(ngModel)]="newUrl" pInputText placeholder="Enter Attack URL"
                  style="width: 100%;" />
              </div>
              <p-button class="col-12 md:col-1" icon="pi pi-plus" (click)="addUrl()"></p-button>
            </div>
          </div>
        </div>
        <div class="grid">
          <div class="grid col-12 md:col-12">
            <div class="surface-section col-12 md:col-12">
              <ul class="list-none p-0 m-0">
                <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap"
                  *ngFor="let url of attackURLs; let i = index">
                  <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1"  style="width: 100%; overflow-wrap: break-word;">{{url}}</div>
                  <div class="w-6 md:w-2 flex justify-content-end">
                    <button pButton pRipple label="Delete" icon="pi pi-trash" (click)="deleteUrl(i)"
                      class="p-button-text p-button-danger"></button>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="surface-card" *ngIf="active4 == 2" style="padding: 4%;">
        <div class="grid">
          <div class="grid col-12 md:col-12">
            <label class="col-12 md:col-12">Steps to Replicate<span style="color: red">*</span>: </label>
            <div class="col-12 md:col-12">
              <p-editor [(ngModel)]="vulnerability.replication" [style]="{'height':'320px'}"></p-editor>
            </div>
          </div>
        </div>
      </div>

      <div class="surface-card" *ngIf="active4 == 3" style="padding: 4%;">
        <div class="grid">
          <div class="grid col-12 md:col-12">
            <label class="col-12 md:col-12">Suggested Remediation<span style="color: red">*</span>: </label>
            <div class="col-12 md:col-12 grid">
              <div class="col-12 md:col-11">
                <input name="port" [(ngModel)]="newRemediation" pInputText placeholder="Enter Remediation"
                  style="width: 100%;" />
              </div>
              <p-button class="col-12 md:col-1" icon="pi pi-plus" (click)="addRemediation()"></p-button>
            </div>
          </div>
        </div>

        <div class="grid">
          <div class="grid col-12 md:col-12">
            <div class="surface-section col-12 md:col-12">
              <ul class="list-none p-0 m-0">
                <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap" *ngFor="let remediation of remediations; let i = index">
                  <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1"  style="width: 100%; overflow-wrap: break-word;" >{{remediation}}</div>
                  <div class="w-6 md:w-2 flex justify-content-end">
                      <button pButton pRipple label="Delete" icon="pi pi-trash" (click)="deleteRemediation(i)" class="p-button-text p-button-danger"></button>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="surface-card" *ngIf="active4 == 4" style="padding: 4%;">
        <div class="grid">
          <div class="grid col-12 md:col-12">
            <label class="col-12 md:col-12">Remarks/References:</label>
            <div class="col-12 md:col-12">
              <p-editor [(ngModel)]="vulnerability.remarks" [style]="{'height':'320px'}"></p-editor>
            </div>
          </div>
        </div>
      </div>

      <div class="surface-card shadow-2 border-round p-4" *ngIf="active4 == 5" style="padding: 4%;">


        <div class="flex align-items-center justify-content-between mb-4">
          <div class="text-900 font-medium text-xl">History</div>
        </div>
        <hr />
        <div class="grid p-3">
          <div class="col-9">
            <!-- <div class="grid formgrid p-fluid">
              <div class="col-3">
                <label for="categories" class="font-medium">Event Category: </label>
                <p-dropdown [options]="categories" [(ngModel)]="cat" optionLabel="name"></p-dropdown>
              </div>
              <div class="col-3 align-items-right">
                <label class="font-medium">Search: </label>
                <span class="p-input-icon-left p-ml-auto">
                  <i class="pi pi-search"></i>
                  <input type="text" class="Normal" placeholder="Search keyword" pInputText />
                </span>
              </div>
            </div> -->
            <div class="p-5 flex flex-column flex-auto" *ngFor="let val of data">
              <span class="block text-600 font-medium mb-3">{{val.date}}</span>
              <ul class="p-0 mx-0 mt-0 mb-4 list-none">
                <li class="flex align-items-center py-2 border-bottom-1 surface-border"
                  *ngFor="let content of val.data">
                  <div
                    class="w-3rem h-3rem flex align-items-center justify-content-center bg-blue-100 border-circle mr-3 flex-shrink-0">
                    <i *ngIf="content.status == 'Reported'" class="pi pi-power-off text-xl text-blue-500"></i>
                    <i *ngIf="content.status == 'Approved'" class="pi pi-dollar text-xl text-green-500"></i>
                    <i *ngIf="content.status == 'Rejected'" class="pi pi-times text-xl text-blue-500"></i>
                    <i *ngIf="content.status == 'Updated'" class="pi pi-refresh text-xl text-blue-500"></i>
                    <i *ngIf="content.status == 'Sent Back'" class="pi pi-backward text-xl text-blue-500"></i>
                  </div>
                  <span class="text-700">{{content.remarks}}</span>
                </li>
              </ul>
            </div>
          </div>
          <!-- <div class="col-3">
            <div class="surface-card shadow-2 border-round p-4 mb-5">
              <div class="flex justify-content-between align-items-center">
                <span class="text-lg text-900">
                  It took <b>6 minutes</b> to reward <span class="text-blue-900">
                    <b><a href="">Naheed Shah</a></b> after vulnerability acceptance.
                  </span>
                </span>
              </div>
            </div>
            <div class="surface-card shadow-2 border-round p-4 mb-5">
              <div class="flex justify-content-between align-items-center">
                <span class="text-lg text-900"><b><a href="">Naheed Shah</a></b> took <b>22 Hours</b> to resolve
                  dispute.</span>
              </div>
            </div>
            <div class="surface-card shadow-2 border-round p-4 mb-5">
              <div class="flex justify-content-between align-items-center">
                <span class="text-lg text-900">Average response time from Program Administrator is <b>14
                    Hours</b></span>
              </div>
            </div>
          </div> -->
        </div>
      </div>
    </div>
  </div>
</div>
<div *ngIf="NotAccessible == true" style="text-align: center;">
  <h1>You are not authorised to see this page</h1>
</div>