import { HttpClient } from '@angular/common/http';
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { MessageService } from 'primeng/api';
import { environment } from '../../environments/environment';

@Component({
  selector: 'app-view-all-vulnerability',
  templateUrl: './view-all-vulnerability.component.html',
  styleUrls: ['./view-all-vulnerability.component.scss']
})
export class ViewAllVulnerabilityComponent implements OnInit {

  projectid:any;
  AllVuln:any[]=[];
  NotAccessible = false;
  projectName;

  constructor(private http:HttpClient,
    private route: ActivatedRoute,
    private router: Router,
    private messageService:MessageService) { }

  ngOnInit(): void {
    this.projectid = this.route.snapshot.params['projectid'];

    this.http.get<any>(environment.apiURL + `programs/`+ this.projectid).subscribe(response => {
      this.projectName = response.bprogramme_name;
    }, error =>{
      this.messageService.add({ severity: 'error', detail: error.error.error });
      this.router.navigate(["/ProgramDetails"]);
    })
    
    this.http.get<any[]>(environment.apiURL + 'vulnerabilitiesOnProject/' + this.projectid).subscribe(response => {
      this.AllVuln = response
      if(this.AllVuln == null){
        this.NotAccessible = true;
      }
    })
  }

}
